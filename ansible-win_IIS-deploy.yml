---
- name: IIS Deployment
  hosts: all
  become: yes
  become_method: runas
  become_user: system


  tasks:

  - name: Ensure IIS Server is present
    win_feature:
      name: Web-Server
      state: present
    register: iis_result
    notify: 
    - Reboot notification
    - Reboot host
    
  - name: print iis_result
    debug:
      var: iis_result
    tags: debug

  - name: Ensure latest index.html file is present
    win_template:
      src: templates/index.j2
      dest: c:\inetpub\wwwroot\index.html


  handlers:

  - name: Reboot notification
    debug:
      msg: "Host reboot is required."
    when: iis_result.reboot_required == true


  - name: Reboot host
    win_reboot:
    when: iis_result.reboot_required == true

...
